<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Spotify Mood Scanner - Detect your mood through facial expressions and get song recommendations">

  <title>Spotify Mood Scanner</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="favicon.png"/>

  <link rel="stylesheet" href="app.css">
</head>
<body>
  <div class="container">
    <!-- Left side: Webcam feed -->
    <div class="webcam-section">
      <video id="webcamVideo" autoplay playsinline muted></video>
      <div class="webcam-overlay">
        <div class="status-badge" id="statusBadge">
          <span class="status-dot"></span>
          <span id="statusText">Initializing...</span>
        </div>
      </div>
    </div>

    <!-- Center: Mood display -->
    <div class="mood-display">
      <div class="mood-content">
        <div class="mood-emoji" id="moodEmoji">üòê</div>
        <div class="mood-name" id="moodName">Detecting...</div>
        <div class="mood-confidence">
          <div class="confidence-label">Confidence</div>
          <div class="confidence-bar">
            <div class="confidence-fill" id="confidenceFill"></div>
          </div>
          <div class="confidence-value" id="confidenceValue">0%</div>
        </div>
      </div>
    </div>

    <!-- Right side: Song recommendations -->
    <div class="songs-section">
      <div class="songs-header">
        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
          <h2>Recommended for You</h2>
          <button id="moodHistoryBtn" class="mood-history-btn" title="View mood history">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 6 13.5 15.5 8 9.5 1 16"></polyline>
              <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
            <span>History</span>
          </button>
        </div>
        <p class="songs-subtitle" id="songsSubtitle">Based on your mood</p>
      </div>
      <div class="songs-list" id="songsList">
        <div class="loading-message">Loading songs...</div>
      </div>
    </div>
  </div>

  <!-- Mood History Modal -->
  <div id="moodHistoryOverlay" class="mood-history-overlay">
    <div class="mood-history-modal">
      <div class="mood-history-header">
        <h3>Mood History</h3>
        <button id="moodHistoryClose" class="modal-close-btn" aria-label="Close modal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="mood-history-controls">
        <div class="time-range-buttons">
          <button class="time-range-btn active" data-range="week">Week</button>
          <button class="time-range-btn" data-range="month">Month</button>
          <button class="time-range-btn" data-range="year">Year</button>
        </div>
      </div>
      <div class="mood-history-content">
        <canvas id="moodChart" height="300"></canvas>
      </div>
      <div class="mood-history-legend">
        <div id="moodLegend" class="legend-items"></div>
      </div>
    </div>
  </div>

  <!-- Forum Results Modal -->
  <div id="forumResultsOverlay" class="forum-results-overlay">
    <div class="forum-results-modal">
      <div class="forum-results-header">
        <h3 id="forumResultsTitle">Forum Discussions</h3>
        <button id="forumResultsClose" class="modal-close-btn" aria-label="Close modal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="forum-results-content">
        <div id="forumResultsList" class="forum-results-list"></div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <script type="importmap">
    {
      "imports": {
        "@mediapipe/tasks-vision": "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/vision_bundle.mjs"
      }
    }
  </script>
  <script src="mood.js"></script>
  <script src="spotify-data.js"></script>
  <script src="app.js"></script>
</body>
</html>
